(function(h,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(h=typeof globalThis<"u"?globalThis:h||self,h.DaisyUITreeView=c())})(this,function(){"use strict";const h={data:[],expandIconUrl:"./assets/chevron-down-solid.svg",collapseIconUrl:"./assets/chevron-right-solid.svg",blankIconUrl:"./assets/blank.svg",hasCheckbox:!1,treeName:"treeView",multipleSelect:!1,multipleCheck:!1,iconHeight:"16px",iconWidth:"16px",inlineEdit:!1,dragNDrop:!1,itemColor:"primary",itemActiveColor:"",itemFocusColor:"",itemHoverColor:"",UseLocalstorage:!1,replace:!1,checkBoxSize:"md",textBoxSize:"sm",checkBoxActiveColor:"",checkBoxActiveBorderColor:""};class c{constructor(e,s={}){if(this.element=e,this.settings={...h,...s},this.treeName=this._normalizeId(this.settings.treeName),this.tree=[],this.nodeMap=new Map,this._checkedNodes=new Set,this._selectedNodes=new Set,this._visibleNodes=new Set,this._activeColor=this.fixColor("checked:bg",this.settings.checkBoxActiveColor),this._activeBorderColor=this.fixColor("checked:border",this.settings.checkBoxActiveBorderColor),this._inputColorClass=`input-${this.settings.itemColor}`,this._checkColorClass=`checkbox-${this.settings.itemColor}`,this._inputSizeClass=`input-${this.settings.textBoxSize}`,this._checkSizeClass=`checkbox-${this.settings.checkBoxSize}`,this.settings.data){let t=Array.isArray(this.settings.data)?JSON.parse(JSON.stringify(this.settings.data)):[];this.tree=t,delete this.settings.data}this._refresh(),this.settings.dragNDrop&&this._enableDragAndDrop(),this.element.addEventListener("blur",this._onBlur.bind(this),!0),this.element.addEventListener("keydown",this._onKeydown.bind(this)),this.element.addEventListener("click",t=>this._onClick(t))}_toggleVisibility(e,s){e&&(s?e.classList.remove("hidden"):e.classList.add("hidden"))}_getElementById(e){return document.getElementById(e)}_onCheckboxChange(e,s){if(!this.nodeExists(e))return;const t=this.findNode(e);this.checkNode(e,s),this._dispatchEvent("nodeChecked",{node:t,checked:s})}fixColor(e,s){if(e=e==null?"":String(e),s=s==null?"":String(s),!e||!s)return"";s.startsWith("#")&&(s=`[${s}]`),(e==="btn"||e==="badge")&&(e="bg");const t=`${e}-${s}`;return t.endsWith("-")?"":t}collapseAll(){const e=s=>{for(const t of s)this._collapseNode(t.nodeId),t.nodes&&e(t.nodes)};e(this.tree)}expandAll(){const e=s=>{for(const t of s)this._expandNode(t.nodeId),t.nodes&&e(t.nodes)};e(this.tree)}_refresh(){const e=document.createDocumentFragment();this._initializeData({nodes:this.tree}),this._build(e,this.tree),this.element.innerHTML="",this.element.appendChild(e)}_initializeData(e){if(e.nodes)for(const s of e.nodes)s.nodeId=this._normalizeId(s.nodeId),s.parentId=this._normalizeId(s.parentId),this._visibleNodes.add(s.nodeId),this.nodeMap.set(s.nodeId,s),s.nodes&&this._initializeData({nodes:s.nodes})}_build(e,s){for(const t of s){const i=document.createElement("li");if(i.id=`${this.treeName}-${t.nodeId}`,i.classList.add("list-item"),i.dataset.id=t.nodeId,i.setAttribute("role","treeitem"),i.setAttribute("aria-expanded",t.expanded||!1),this.settings.dragNDrop&&i.setAttribute("draggable","true"),i.setAttribute("aria-selected",this._selectedNodes.has(t.nodeId)||!1),this.settings.itemColor!==""&&i.classList.add(this.settings.itemColor),this.settings.itemActiveColor!==""&&i.classList.add(this.settings.itemActiveColor),this.settings.itemFocusColor!==""&&i.classList.add(this.settings.itemFocusColor),this.settings.itemHoverColor!==""&&i.classList.add(this.settings.itemHoverColor),this._visibleNodes.has(t.nodeId)||this._toggleVisibility(i,!1),this._selectedNodes.has(t.nodeId)&&i.classList.add("menu-active"),t.disabled&&(i.setAttribute("aria-disabled","true"),i.classList.add("menu-disabled")),t.nodes&&t.nodes.length>0){const d=document.createElement("details");d.id=`${this.treeName}-${t.nodeId}-details`,d.dataset.id=t.nodeId,d.classList.add("xdetails"),i.classList.add("xdetails"),t.expanded&&d.setAttribute("open","");const n=document.createElement("summary");if(n.id=`${this.treeName}-${t.nodeId}-summary`,n.dataset.id=t.nodeId,n.classList.add("xsummary"),t.iconUrl===""&&(t.iconUrl=this.settings.collapseIconUrl),t.iconUrl){const r=document.createElement("svg-renderer");r.setAttribute("replace",this.settings.replace),r.id=`${this.treeName}-${t.nodeId}-icon`,r.dataset.id=t.nodeId,r.setAttribute("use-localstorage",this.settings.UseLocalstorage),r.dataset.src=t.expanded?this.settings.expandIconUrl:this.settings.collapseIconUrl,r.classList.add("state-icon","xicon"),r.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),r.setAttribute("fill","currentColor"),r.setAttribute("data-js","enabled"),r.setAttribute("width",this.settings.iconWidth),r.setAttribute("height",this.settings.iconHeight),n.appendChild(r)}if(this.settings.hasCheckbox){const r=document.createElement("input");r.id=`${this.treeName}-${t.nodeId}-check`,r.type="checkbox",r.classList.add("checkbox"),r.classList.add(this._checkColorClass),r.classList.add(this.settings.checkBoxSize),r.classList.add(this._activeColor),r.classList.add(this._activeBorderColor),r.classList.add(this._checkSizeClass),r.dataset.id=t.nodeId,r.checked=this._checkedNodes.has(t.nodeId),n.appendChild(r)}const o=document.createElement("input");o.id=`${this.treeName}-${t.nodeId}-input`,o.type="text",o.value=t.text,o.classList.add("input","input-ghost","hidden","xinput","w-full"),o.classList.add(this.settings.textBoxSize),o.classList.add(this._inputColorClass),o.classList.add(this._inputSizeClass),o.dataset.id=t.nodeId,n.appendChild(o);const a=document.createElement("span");a.id=`${this.treeName}-${t.nodeId}-text`,a.textContent=t.text,a.dataset.id=t.nodeId,a.classList.add("xspan"),n.appendChild(a),d.appendChild(n);const l=document.createElement("ul");l.id=`${this.treeName}-${t.nodeId}-ul`,l.dataset.id=t.nodeId,this._build(l,t.nodes),d.appendChild(l),i.appendChild(d)}else{const d=document.createElement("a");if(d.id=`${this.treeName}-${t.nodeId}-anchor`,d.dataset.id=t.nodeId,d.classList.add("xanchor"),this.settings.itemColor!==""&&d.classList.add(this.settings.itemColor),this.settings.itemActiveColor!==""&&d.classList.add(this.settings.itemActiveColor),this.settings.itemFocusColor!==""&&d.classList.add(this.settings.itemFocusColor),this.settings.itemHoverColor!==""&&d.classList.add(this.settings.itemHoverColor),t.href&&d.setAttribute("href",t.href),t.iconUrl===""&&(t.iconUrl=this.settings.blankIconUrl),t.iconUrl){const a=document.createElement("svg-renderer");a.setAttribute("replace",this.settings.replace),a.setAttribute("use-localstorage",this.settings.UseLocalstorage),a.dataset.id=t.nodeId,a.dataset.src=t.iconUrl,a.id=`${this.treeName}-${t.nodeId}-icon`,a.classList.add("state-icon"),a.setAttribute("style","pointer-events:none; min-height:"+this.settings.iconHeight+"; min-width:"+this.settings.iconWidth+";"),a.setAttribute("fill","currentColor"),a.setAttribute("data-js","enabled"),a.setAttribute("width",this.settings.iconWidth),a.setAttribute("height",this.settings.iconHeight),d.appendChild(a)}if(this.settings.hasCheckbox){const a=document.createElement("input");a.id=`${this.treeName}-${t.nodeId}-check`,a.type="checkbox",a.classList.add("checkbox"),a.dataset.id=t.nodeId,a.checked=this._checkedNodes.has(t.nodeId),a.classList.add(this._checkColorClass),a.classList.add(this.settings.checkBoxSize),a.classList.add(this._activeColor),a.classList.add(this._activeBorderColor),a.classList.add(this._checkSizeClass),d.appendChild(a)}const n=document.createElement("input");n.id=`${this.treeName}-${t.nodeId}-input`,n.type="text",n.value=t.text,n.classList.add("input","input-ghost","hidden","w-full","xinput"),n.classList.add(this.settings.textBoxSize),n.classList.add(this._inputColorClass),n.classList.add(this._inputSizeClass),n.dataset.id=t.nodeId,d.appendChild(n);const o=document.createElement("span");o.id=`${this.treeName}-${t.nodeId}-text`,o.textContent=t.text,o.dataset.id=t.nodeId,o.classList.add("xspan"),d.appendChild(o),i.appendChild(d)}e.appendChild(i)}}_onClick(e){const s=e.target.closest(".checkbox");if(s){e.stopPropagation();const n=this._normalizeId(s.dataset.id);if(this.nodeExists(n)){const o=s.checked;this._onCheckboxChange(n,o)}return}const t=e.target.closest(".xsummary");if(t){e.stopPropagation();const n=this._normalizeId(t.dataset.id);if(!this.nodeExists(n))return;const o=this.findNode(n);let l=this._getElementById(`${this.treeName}-${n}-details`).hasAttribute("open");l=!l,o.expanded=l;const r=l?"nodeExpanded":"nodeCollapsed",u=this._getElementById(`${this.treeName}-${n}-icon`);u&&(l?u.setAttribute("data-src",this.settings.expandIconUrl):u.setAttribute("data-src",this.settings.collapseIconUrl),o.iconUrl=u.getAttribute("data-src")),this._dispatchEvent(r,{node:o});return}const i=e.target.closest(".xspan");if(i){e.stopPropagation();const n=this._normalizeId(i.dataset.id);if(!this.nodeExists(n))return;const o=this.findNode(n);if(this.settings.inlineEdit&&e.target.id===`${this.treeName}-${n}-text`){this._enableInlineEdit(n);return}this._dispatchEvent("nodeClick",{node:o});return}const d=e.target.closest(".xanchor");if(d){e.stopPropagation();const n=this._normalizeId(d.dataset.id);if(!this.nodeExists(n))return;const o=this.findNode(n);if(this.settings.inlineEdit){this._enableInlineEdit(n);return}this._dispatchEvent("nodeClick",{node:o});return}}_enableDragAndDrop(){this.element.addEventListener("dragend",e=>{const s=this.element.querySelector(".drag-over");s&&s.classList.remove("drag-over")}),this.element.addEventListener("dragstart",e=>{const s=e.target.closest(".list-item");s&&e.dataTransfer.setData("id",s.dataset.id)}),this.element.addEventListener("dragover",e=>{e.preventDefault();const s=e.target.closest(".list-item");s&&s.classList.add("drag-over")}),this.element.addEventListener("dragleave",e=>{const s=e.target.closest(".list-item");s&&s.classList.remove("drag-over")}),this.element.addEventListener("drop",e=>{e.preventDefault();const s=e.target.closest(".list-item");if(!s)return;const t=e.dataTransfer.getData("id"),i=s.dataset.id;if(t===i)return;const d=this.findNode(t),n=this.findNode(i);let o=n;for(;o;){if(o.nodeId===t)return;o=this.findNode(o.parentId)}d&&n&&(this._dispatchEvent("nodeDragStart",{draggedNode:d}),this._dispatchEvent("nodeDrop",{draggedNode:d,targetNode:n}),this.removeNode(t),this.addNode(i,d.nodeId,d.iconUrl,d.text,d.href,d.hasCheckbox),this._refresh())})}_normalizeId(e){return(e??"").toString().trim().toLowerCase()}_cstr(e){return(e??"").toString()}nodeExists(e){const s=this._normalizeId(e);return s===""?!1:this.nodeMap.has(s)}findNode(e){const s=this._normalizeId(e);return s===""?null:this.nodeMap.get(s)||null}addNode(e,s,t="",i,d=""){if(e=this._normalizeId(e),s=this._normalizeId(s),t=this._cstr(t),i=this._cstr(i),d=this._cstr(d),s===""||this.nodeExists(s))return;const n=this.settings.hasCheckbox||!1,o={nodeId:s,parentId:e,iconUrl:t,text:i,href:d,hasCheckbox:n};if(e==="")this.tree.push(o);else{const a=this.findNode(e);a&&(a.nodes=a.nodes||[],a.nodes.push(o),this.nodeMap.set(e,a))}this.nodeMap.set(s,o),this._visibleNodes.add(s)}findNodeRecursive(e,s){for(const t of e){if(t.nodeId===s)return t;if(t.nodes&&t.nodes.length>0){const i=findNodeRecursive(t.nodes,s);if(i)return i}}return null}hideNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),t=i=>{if(!i)return;this._visibleNodes.delete(i.nodeId),i.visible=!1;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&this._toggleVisibility(d,!1),i.nodes&&i.nodes.forEach(n=>t(n))};t(s)}showNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),t=i=>{if(!i)return;this._visibleNodes.add(i.nodeId),i.visible=!0;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&this._toggleVisibility(d,!0),i.nodes&&i.nodes.forEach(n=>t(n))};t(s)}checkNode(e,s){if(!this.nodeExists(e))return;const t=this.findNode(e),i=(d,n)=>{if(!d)return;n?this._checkedNodes.add(d.nodeId):this._checkedNodes.delete(d.nodeId),d.checked=n;const o=this._getElementById(`${this.treeName}-${d.nodeId}-check`);o&&(o.checked=n),d.nodes&&d.nodes.forEach(a=>i(a,n))};i(t,s)}expandNode(e,s){s?this._expandNode(e):this._collapseNode(e)}removeNode(e){if(e=this._normalizeId(e),!this.nodeExists(e))return;const s=this.findNode(e);if(s.parentId){const i=this.findNode(s.parentId);i&&i.nodes&&(i.nodes=i.nodes.filter(d=>d.nodeId!==e))}else this.tree=this.tree.filter(i=>i.nodeId!==e);this.nodeMap.delete(e);const t=this._getElementById(`${this.treeName}-${e}`);t&&t.remove(),this._visibleNodes.delete(e),this._selectedNodes.delete(e),this._checkedNodes.delete(e)}_expandNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e);s.expanded=!0;const t=this._getElementById(`${this.treeName}-${s.nodeId}-details`);t&&t.setAttribute("open","")}_collapseNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e);s.expanded=!1;const t=this._getElementById(`${this.treeName}-${s.nodeId}-details`);t&&t.removeAttribute("open")}enableNode(e,s){s?this._enableNode(e):this._disableNode(e)}_enableNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),t=i=>{if(!i)return;i.disabled=!1;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&d.classList.remove("menu-disabled"),i.nodes&&i.nodes.forEach(n=>t(n))};t(s)}_disableNode(e){if(!this.nodeExists(e))return;const s=this.findNode(e),t=i=>{if(!i)return;i.disabled=!0;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&d.classList.add("menu-disabled"),i.nodes&&i.nodes.forEach(n=>t(n))};t(s)}clear(){this.nodeMap.clear(),this.tree=[],this._checkedNodes.clear(),this._selectedNodes.clear(),this._visibleNodes.clear()}getChildren(e){if(!this.nodeExists(e))return[];const s=this.findNode(e);return Array.isArray(s.nodes)?[...s.nodes]:[]}removeChildren(e){if(!this.nodeExists(e))return;const s=this.findNode(e);s.nodes&&(s.nodes.forEach(t=>this._checkedNodes.delete(t.nodeId)),s.nodes.forEach(t=>this._selectedNodes.delete(t.nodeId)),s.nodes.forEach(t=>this._visibleNodes.delete(t.nodeId)),s.nodes.forEach(t=>this.removeNode(t.nodeId))),s.nodes=[]}updateNode(e,s,t,i=""){if(e=this._normalizeId(e),s=this._cstr(s),t=this._cstr(t),i=this._cstr(i),e===""||!this.nodeExists(e))return;const d=this.findNode(e);d.iconUrl=s,d.text=t,d.href=i;const n=this._getElementById(`${this.treeName}-${d.nodeId}-text`);n&&(n.textContent=t);const o=this._getElementById(`${this.treeName}-${d.nodeId}-input`);o&&(o.value=t);const a=this._getElementById(`${this.treeName}-${d.nodeId}-icon`);a&&(a.dataset.src=s)}selectNode(e,s){if(!this.nodeExists(e))return;const t=this.findNode(e),i=(d,n)=>{if(!d)return;n?this._selectedNodes.add(d.nodeId):this._selectedNodes.delete(d.nodeId),d.selected=n;const o=this._getElementById(`${this.treeName}-${d.nodeId}`);o&&(n?o.classList.add("menu-active"):o.classList.remove("menu-active")),d.nodes&&d.nodes.forEach(a=>i(a,n))};i(t,s)}clearSelected(){this._selectedNodes.forEach(e=>this.selectNode(e.nodeId,!1)),this._selectedNodes.clear()}clearChecked(){this._checkedNodes.forEach(e=>this.checkNode(e.nodeId,!1)),this._checkedNodes.clear()}selectNodes(e){this._selectedNodes.forEach(t=>this.selectNode(t.nodeId,!1)),new Set(e.map(t=>this._normalizeId(t))).forEach(t=>this.selectNode(t,!0))}getSelectedNode(e=!1){const s=this.element.querySelector(".menu-active");if(!s)return null;const t=this._normalizeId(s.dataset.id),i=this.findNode(t);return!i||!e?i:{...i,nodes:i.nodes??[]}}getSelectedNodes(){return Array.from(this._selectedNodes)}getCheckedNodes(){return Array.from(this._checkedNodes)}checkNodes(e){this._checkedNodes.forEach(t=>this.checkNode(t.nodeId,!1));const s=new Set(e.map(t=>this._normalizeId(t)));s.forEach(t=>this.checkNode(t,!0)),this._dispatchEvent("nodesChecked",{nodeIds:s})}enableInlineEditing(e){this._enableInlineEdit(e)}refresh(){this._refresh()}_dispatchEvent(e,s){const t=new CustomEvent(e,{detail:s});this.element.dispatchEvent(t)}_onBlur(e){const s=e.target.closest("input.xinput");if(!s)return;const t=this._normalizeId(s.dataset.id),i=this.findNode(t);if(!i)return;const d=this._getElementById(`${this.treeName}-${t}-text`);if(!d)return;const n=i.text;if(s.value.trim()===""){this._toggleVisibility(s,!1),this._toggleVisibility(d,!0),this._dispatchEvent("nodeEditCancelled",{node:i});return}if(s.value.trim()===n){this._toggleVisibility(s,!1),this._toggleVisibility(d,!0),this._dispatchEvent("nodeEditCancelled",{node:i});return}i.text=s.value.trim(),d.textContent=s.value.trim(),s.value=s.value.trim(),this._toggleVisibility(s,!1),this._toggleVisibility(d,!0),this._dispatchEvent("nodeEdited",{node:i})}_onKeydown(e){const s=e.target.closest("input.xinput");if(!s)return;const t=this._normalizeId(s.dataset.id),i=this.findNode(t);if(!i)return;const d=this._getElementById(`${this.treeName}-${t}-text`);if(!d)return;const n=i.text;e.key==="Enter"?s.blur():e.key==="Escape"&&(i.text=n,d.textContent=n,s.value=n,s.blur())}_enableInlineEdit(e){const s=this.findNode(e);if(!s)return;const t=this._getElementById(`${this.treeName}-${e}-text`),i=this._getElementById(`${this.treeName}-${e}-input`);!t||!i||(i.value=s.text,this._toggleVisibility(t,!1),this._toggleVisibility(i,!0),i.focus())}}return c});
