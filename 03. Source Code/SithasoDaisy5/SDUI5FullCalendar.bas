B4J=true
Group=Default Group
ModulesStructureVersion=1
Type=Class
Version=10.2
@EndOfDesignText@
#IgnoreWarnings:12
#Event: EventClick (args As Map)
#Event: EventDrop (args As Map)
#Event: EventResize (args As Map)
#Event: Drop (args As Map)
#Event: DateClick (args As Map)
#Event: Select (args As Map)
#Event: NextMonth (e As BANanoEvent)
#Event: PrevMonth (e As BANanoEvent)
#Event: NextYear (e As BANanoEvent)
#Event: PrevYear (e As BANanoEvent)
#Event: DateRangeChange (startDate As String, endDate As String, lastView As string)
#DesignerProperty: Key: ParentID, DisplayName: ParentID, FieldType: String, DefaultValue: , Description: The ParentID of this component
#DesignerProperty: Key: InitialDate, DisplayName: Initial Date, FieldType: String, DefaultValue: now, Description: Initial Date
#DesignerProperty: Key: InitialView, DisplayName: Initial View, FieldType: String, DefaultValue: dayGridMonth, Description: Initial View, List: dayGridMonth|dayGridWeek|listMonth|listWeek|timeGridDay|timeGridWeek|multiMonthYear
#DesignerProperty: Key: Height, DisplayName: Height, FieldType: String, DefaultValue: auto, Description: Height
#DesignerProperty: Key: MonthText, DisplayName: Month Text, FieldType: String, DefaultValue: month, Description: Month Text
#DesignerProperty: Key: DayText, DisplayName: Day Text, FieldType: String, DefaultValue: day, Description: Day Text
#DesignerProperty: Key: ToDayText, DisplayName: To Day Text, FieldType: String, DefaultValue: today, Description: Today Text
#DesignerProperty: Key: WeekText, DisplayName: Week Text, FieldType: String, DefaultValue: week, Description: Week Text
#DesignerProperty: Key: AspectRatio, DisplayName: Aspect Ratio, FieldType: String, DefaultValue: 3, Description: Aspect Ratio
#DesignerProperty: Key: BusinessHours, DisplayName: Business Hours, FieldType: Boolean, DefaultValue: False, Description: Business Hours
#DesignerProperty: Key: ButtonIcons, DisplayName: Button Icons, FieldType: Boolean, DefaultValue: True, Description: Show The Prev/next Text
#DesignerProperty: Key: ContentHeight, DisplayName: Content Height, FieldType: String, DefaultValue: auto, Description: Content Height
#DesignerProperty: Key: DayMaxEvents, DisplayName: Day Max Events, FieldType: Boolean, DefaultValue: True, Description: Day Max Events
#DesignerProperty: Key: Droppable, DisplayName: Droppable, FieldType: Boolean, DefaultValue: True, Description: Droppable
#DesignerProperty: Key: Editable, DisplayName: Editable, FieldType: Boolean, DefaultValue: True, Description: Editable
#DesignerProperty: Key: ExpandRows, DisplayName: Expand Rows, FieldType: Boolean, DefaultValue: False, Description: Expand Rows
#DesignerProperty: Key: HeaderToolbarCenter, DisplayName: Header Toolbar Center, FieldType: String, DefaultValue: title, Description: Header Toolbar Center
#DesignerProperty: Key: HeaderToolbarLeft, DisplayName: Header Toolbar Left, FieldType: String, DefaultValue: prevYear;prev;next;nextYear today, Description: Header Toolbar Left
#DesignerProperty: Key: HeaderToolbarRight, DisplayName: Header Toolbar Right, FieldType: String, DefaultValue: dayGridMonth;timeGridWeek;timeGridDay;listMonth;multiMonthYear, Description: Header Toolbar Right
#DesignerProperty: Key: HeaderToolbarVisible, DisplayName: Header Toolbar Visible, FieldType: Boolean, DefaultValue: True, Description: Header Toolbar Visible
#DesignerProperty: Key: ListText, DisplayName: List Text, FieldType: String, DefaultValue: list, Description: List Text
#DesignerProperty: Key: Locale, DisplayName: Locale, FieldType: String, DefaultValue: en, Description: Locale
#DesignerProperty: Key: NavLinks, DisplayName: Nav Links, FieldType: Boolean, DefaultValue: True, Description: Nav Links
#DesignerProperty: Key: NextClickOn, DisplayName: Next Click On, FieldType: Boolean, DefaultValue: False, Description: Next Click On
#DesignerProperty: Key: NowIndicator, DisplayName: Now Indicator, FieldType: Boolean, DefaultValue: True, Description: Now Indicator
#DesignerProperty: Key: PrevClickOn, DisplayName: Prev Click On, FieldType: Boolean, DefaultValue: False, Description: Prev Click On
#DesignerProperty: Key: ScrollTime, DisplayName: Scroll Time, FieldType: String, DefaultValue: 06:00:00, Description: Determines How Far Forward The Scroll Pane Is Initially Scrolled
#DesignerProperty: Key: ScrollTimeReset, DisplayName: Scroll Time Reset, FieldType: Boolean, DefaultValue: True, Description: Whether The View Should Scroll To Scrolltime Every Time The Date Range Changes.
#DesignerProperty: Key: SelectMirror, DisplayName: Select Mirror, FieldType: Boolean, DefaultValue: True, Description: Select Mirror
#DesignerProperty: Key: Selectable, DisplayName: Selectable, FieldType: Boolean, DefaultValue: True, Description: Selectable
#DesignerProperty: Key: SlotDuration, DisplayName: Slot Duration, FieldType: String, DefaultValue: 00:30:00, Description: The Frequency For Displaying Time Slots.
#DesignerProperty: Key: SlotMaxTime, DisplayName: Slot Max Time, FieldType: String, DefaultValue: 24:00:00, Description: The Last Time Slot That Will Be Displayed For Each Day
#DesignerProperty: Key: SlotMinTime, DisplayName: Slot Min Time, FieldType: String, DefaultValue: 00:00:00, Description: The First Time Slot That Will Be Displayed For Each Day
#DesignerProperty: Key: WeekNumbers, DisplayName: Week Numbers, FieldType: Boolean, DefaultValue: False, Description: Week Numbers
#DesignerProperty: Key: Visible, DisplayName: Visible, FieldType: Boolean, DefaultValue: True, Description: If visible.
#DesignerProperty: Key: Enabled, DisplayName: Enabled, FieldType: Boolean, DefaultValue: True, Description: If enabled.
#DesignerProperty: Key: PositionStyle, DisplayName: Position Style, FieldType: String, DefaultValue: none, Description: Position, List: absolute|fixed|none|relative|static|sticky
#DesignerProperty: Key: Position, DisplayName: Position Locations, FieldType: String, DefaultValue: t=?; b=?; r=?; l=?, Description: Position Locations
#DesignerProperty: Key: MarginAXYTBLR, DisplayName: Margins, FieldType: String, DefaultValue: a=?; x=?; y=?; t=?; b=?; l=?; r=? , Description: Margins A(all)-X(LR)-Y(TB)-T-B-L-R
#DesignerProperty: Key: PaddingAXYTBLR, DisplayName: Paddings, FieldType: String, DefaultValue: a=?; x=?; y=?; t=?; b=?; l=?; r=? , Description: Paddings A(all)-X(LR)-Y(TB)-T-B-L-R
#DesignerProperty: Key: RawClasses, DisplayName: Classes (;), FieldType: String, DefaultValue: , Description: Classes added to the HTML tag.
#DesignerProperty: Key: RawStyles, DisplayName: Styles (JSON), FieldType: String, DefaultValue: , Description: Styles added to the HTML tag. Must be a json String use = and ;
#DesignerProperty: Key: RawAttributes, DisplayName: Attributes (JSON), FieldType: String, DefaultValue: , Description: Attributes added to the HTML tag. Must be a json String use = and ;
'global variables in this module
Sub Class_Globals
	Public UI As UIShared 'ignore
	Public CustProps As Map 'ignore
	Private mCallBack As Object 'ignore
	Private mEventName As String 'ignore
	Private mElement As BANanoElement 'ignore
	Private mTarget As BANanoElement 'ignore
	Private mName As String 'ignore
	Private BANano As BANano   'ignore
	Private sPosition As String = "t=?; b=?; r=?; l=?"
	Private sPositionStyle As String = "none"
	Private sRawClasses As String = ""
	Private sRawStyles As String = ""
	Private sRawAttributes As String = ""
	Private sMarginAXYTBLR As String = "a=?; x=?; y=?; t=?; b=?; l=?; r=?"
	Private sPaddingAXYTBLR As String = "a=?; x=?; y=?; t=?; b=?; l=?; r=?"
	Private sParentID As String = ""
	Private bVisible As Boolean = True	'ignore
	Private bEnabled As Boolean = True	'ignore
	Public Tag As Object
	Private Options As Map
	Private sAspectRatio As String = "3"
	Private bBusinessHours As Boolean = False
	Private bButtonIcons As Boolean = True
	Private sContentHeight As String = "auto"
	Private bDayMaxEvents As Boolean = True
	Private sDayText As String = "day"
	Private bDroppable As Boolean = True
	Private bEditable As Boolean = True
	Private bExpandRows As Boolean = False
	Private sHeaderToolbarCenter As String = "title"
	Private sHeaderToolbarLeft As String = "prevYear;prev;next;nextYear today"
	Private sHeaderToolbarRight As String = "dayGridMonth;timeGridWeek;timeGridDay;listMonth;multiMonthYear"
	Private bHeaderToolbarVisible As Boolean = True
	Private sHeight As String = "auto"
	Private sInitialDate As String = "now"
	Private sInitialView As String = "dayGridMonth"
	Private sListText As String = "list"
	Private sLocale As String = "en"
	Private sMonthText As String = "month"
	Private bNavLinks As Boolean = True
	Private bNextClickOn As Boolean = False
	Private bNowIndicator As Boolean = True
	Private bPrevClickOn As Boolean = False
	Private bScrollTimeReset As Boolean = True
	Private bSelectMirror As Boolean = True
	Private bSelectable As Boolean = True
	Private sToDayText As String = "today"
	Private bWeekNumbers As Boolean = False
	Private sWeekText As String = "week"
	Private sScrollTime As String = "06:00:00"
	Private sSlotDuration As String = "00:30:00"
	Private sSlotMaxTime As String = "24:00:00"
	Private sSlotMinTime As String = "00:00:00"
	Private sContentHeight As String = "auto"
	Public CONST INITIALVIEW_DAYGRIDMONTH As String = "dayGridMonth"
	Public CONST INITIALVIEW_DAYGRIDWEEK As String = "dayGridWeek"
	Public CONST INITIALVIEW_LISTMONTH As String = "listMonth"
	Public CONST INITIALVIEW_LISTWEEK As String = "listWeek"
	Public CONST INITIALVIEW_TIMEGRIDDAY As String = "timeGridDay"
	Public CONST INITIALVIEW_TIMEGRIDWEEK As String = "timeGridWeek"
	Public const INITIALVIEW_MULTIMONTHYEAR As String = "multiMonthYear"
	Private fc As BANanoObject
	Private events As List
End Sub
'initialize the custom view class
Public Sub Initialize (Callback As Object, Name As String, EventName As String)
	If BANano.AssetsIsDefined("FullCalendar") = False Then
		BANano.Throw($"Uses Error: 'BANano.Await(app.UsesFullCalendar)' should be added!"$)
		Return
	End If
	UI.Initialize(Me)
	mElement = Null
	mEventName = UI.CleanID(EventName)
	mName = UI.CleanID(Name)
	mCallBack = Callback
	CustProps.Initialize
	Options.Initialize
	events.Initialize
	BANano.DependsOnAsset("fc.min.css")
	BANano.DependsOnAsset("fullcalendar.css")
	BANano.DependsOnAsset("fc.min.js")
	BANano.DependsOnAsset("fclocales.min.js")
	SetDefaults
End Sub

private Sub SetDefaults
	CustProps.Put("ParentID", "")
	CustProps.Put("InitialDate", "now")
	CustProps.Put("InitialView", "dayGridMonth")
	CustProps.Put("Height", "auto")
	CustProps.Put("MonthText", "month")
	CustProps.Put("DayText", "day")
	CustProps.Put("ToDayText", "today")
	CustProps.Put("WeekText", "week")
	CustProps.Put("AspectRatio", "3")
	CustProps.Put("BusinessHours", False)
	CustProps.Put("ButtonIcons", True)
	CustProps.Put("ContentHeight", "auto")
	CustProps.Put("DayMaxEvents", True)
	CustProps.Put("Droppable", True)
	CustProps.Put("Editable", True)
	CustProps.Put("ExpandRows", False)
	CustProps.Put("HeaderToolbarCenter", "title")
	CustProps.Put("HeaderToolbarLeft", "prevYear;prev;next;nextYear today")
	CustProps.Put("HeaderToolbarRight", "dayGridMonth;timeGridWeek;timeGridDay;listMonth;multiMonthYear")
	CustProps.Put("HeaderToolbarVisible", True)
	CustProps.Put("ListText", "list")
	CustProps.Put("Locale", "en")
	CustProps.Put("NavLinks", True)
	CustProps.Put("NextClickOn", False)
	CustProps.Put("NowIndicator", True)
	CustProps.Put("PrevClickOn", False)
	CustProps.Put("ScrollTime", "06:00:00")
	CustProps.Put("ScrollTimeReset", True)
	CustProps.Put("SelectMirror", True)
	CustProps.Put("Selectable", True)
	CustProps.Put("SlotDuration", "00:30:00")
	CustProps.Put("SlotMaxTime", "24:00:00")
	CustProps.Put("SlotMinTime", "00:00:00")
	CustProps.Put("WeekNumbers", False)
	CustProps.Put("Visible", True)
	CustProps.Put("Enabled", True)
	CustProps.Put("PositionStyle", "none")
	CustProps.Put("Position", "t=?; b=?; r=?; l=?")
	CustProps.Put("MarginAXYTBLR", "a=?; x=?; y=?; t=?; b=?; l=?; r=?")
	CustProps.Put("PaddingAXYTBLR", "a=?; x=?; y=?; t=?; b=?; l=?; r=?")
	CustProps.Put("RawClasses", "")
	CustProps.Put("RawStyles", "")
	CustProps.Put("RawAttributes", "")
End Sub
' returns the element id
Public Sub getID() As String
	Return mName
End Sub
'set properties from an outside source
Sub SetProperties(props As Map)
	CustProps = BANano.DeepClone(props)
	sParentID = CustProps.Get("ParentID")
End Sub

Sub GetProperties As Map
	Return CustProps
End Sub
'add this element to an existing parent element using current props
Public Sub AddComponent
	If sParentID = "" Then Return
	sParentID = UI.CleanID(sParentID)
	mTarget = BANano.GetElement("#" & sParentID)
	DesignerCreateView(mTarget, CustProps)
End Sub
'remove this element from the dom
Public Sub Remove()
	mElement.Remove
	BANano.SetMeToNull
End Sub
'set the parent id
Sub setParentID(s As String)
	s = UI.CleanID(s)
	sParentID = s
	CustProps.Put("ParentID", sParentID)
End Sub
'get the parent id
Sub getParentID As String
	Return sParentID
End Sub
'return the #ID of the element
Public Sub getHere() As String
	Return $"#${mName}"$
End Sub
'set Visible
Sub setVisible(b As Boolean)
	bVisible = b
	CustProps.Put("Visible", b)
	If mElement = Null Then Return
	UI.SetVisible(mElement, b)
End Sub
'get Visible
Sub getVisible As Boolean
	bVisible = UI.GetVisible(mElement)
	Return bVisible
End Sub
'set Enabled
Sub setEnabled(b As Boolean)
	bEnabled = b
	CustProps.Put("Enabled", b)
	If mElement = Null Then Return
	UI.SetEnabled(mElement, b)
End Sub
'get Enabled
Sub getEnabled As Boolean
	bEnabled = UI.GetEnabled(mElement)
	Return bEnabled
End Sub
'use to add an event to the element
Sub OnEvent(event As String, methodName As String)
	UI.OnEvent(mElement, event, mCallBack, methodName)
End Sub
'set Position Style
'options: static|relative|fixed|absolute|sticky|none
Sub setPositionStyle(s As String)
	sPositionStyle = s
	CustProps.put("PositionStyle", s)
	If mElement = Null Then Return
	If s <> "" Then UI.AddStyle(mElement, "position", s)
End Sub
Sub getPositionStyle As String
	Return sPositionStyle
End Sub
'set raw positions
Sub setPosition(s As String)
	sPosition = s
	CustProps.Put("Position", sPosition)
	If mElement = Null Then Return
	If s <> "" Then UI.SetPosition(mElement, sPosition)
End Sub
Sub getPosition As String
	Return sPosition
End Sub
Sub setAttributes(s As String)
	sRawAttributes = s
	CustProps.Put("RawAttributes", s)
	If mElement = Null Then Return
	If s <> "" Then UI.SetAttributes(mElement, sRawAttributes)
End Sub
'
Sub setStyles(s As String)
	sRawStyles = s
	CustProps.Put("RawStyles", s)
	If mElement = Null Then Return
	If s <> "" Then UI.SetStyles(mElement, sRawStyles)
End Sub
'
Sub setClasses(s As String)
	sRawClasses = s
	CustProps.put("RawClasses", s)
	If mElement = Null Then Return
	If s <> "" Then UI.SetClasses(mElement, sRawClasses)
End Sub
'
Sub setPaddingAXYTBLR(s As String)
	sPaddingAXYTBLR = s
	CustProps.Put("PaddingAXYTBLR", s)
	If mElement = Null Then Return
	If s <> "" Then UI.SetPaddingAXYTBLR(mElement, sPaddingAXYTBLR)
End Sub
'
Sub setMarginAXYTBLR(s As String)
	sMarginAXYTBLR = s
	CustProps.Put("MarginAXYTBLR", s)
	If mElement = Null Then Return
	If s <> "" Then UI.SetMarginAXYTBLR(mElement, sMarginAXYTBLR)
End Sub
'
Sub getAttributes As String
	Return sRawAttributes
End Sub
'
Sub getStyles As String
	Return sRawStyles
End Sub
'
Sub getClasses As String
	Return sRawClasses
End Sub
'
Sub getPaddingAXYTBLR As String
	Return sPaddingAXYTBLR
End Sub
'
Sub getMarginAXYTBLR As String
	Return sMarginAXYTBLR
End Sub
'code to design the view
Public Sub DesignerCreateView (Target As BANanoElement, Props As Map)
	mTarget = Target
	If Props <> Null Then
		CustProps = Props
		UI.SetProps(Props)
		'UI.ExcludeBackgroundColor = True
		'UI.ExcludeTextColor = True
		'UI.ExcludeVisible = True
		'UI.ExcludeEnabled = True
		sAspectRatio = Props.GetDefault("AspectRatio", "3")
		sAspectRatio = UI.CStr(sAspectRatio)
		bBusinessHours = Props.GetDefault("BusinessHours", False)
		bBusinessHours = UI.CBool(bBusinessHours)
		bButtonIcons = Props.GetDefault("ButtonIcons", True)
		bButtonIcons = UI.CBool(bButtonIcons)
		sContentHeight = Props.GetDefault("ContentHeight", "auto")
		sContentHeight = UI.CStr(sContentHeight)
		bDayMaxEvents = Props.GetDefault("DayMaxEvents", True)
		bDayMaxEvents = UI.CBool(bDayMaxEvents)
		sDayText = Props.GetDefault("DayText", "day")
		sDayText = UI.CStr(sDayText)
		bDroppable = Props.GetDefault("Droppable", True)
		bDroppable = UI.CBool(bDroppable)
		bEditable = Props.GetDefault("Editable", True)
		bEditable = UI.CBool(bEditable)
		bExpandRows = Props.GetDefault("ExpandRows", False)
		bExpandRows = UI.CBool(bExpandRows)
		sHeaderToolbarCenter = Props.GetDefault("HeaderToolbarCenter", "title")
		sHeaderToolbarCenter = UI.CStr(sHeaderToolbarCenter)
		sHeaderToolbarLeft = Props.GetDefault("HeaderToolbarLeft", "prevYear;prev;next;nextYear today")
		sHeaderToolbarLeft = UI.CStr(sHeaderToolbarLeft)
		sHeaderToolbarRight = Props.GetDefault("HeaderToolbarRight", "dayGridMonth;timeGridWeek;timeGridDay;listMonth;multiMonthYear")
		sHeaderToolbarRight = UI.CStr(sHeaderToolbarRight)
		bHeaderToolbarVisible = Props.GetDefault("HeaderToolbarVisible", True)
		bHeaderToolbarVisible = UI.CBool(bHeaderToolbarVisible)
		sHeight = Props.GetDefault("Height", "auto")
		sHeight = UI.CStr(sHeight)
		sInitialDate = Props.GetDefault("InitialDate", "now")
		sInitialDate = UI.CStr(sInitialDate)
		sInitialView = Props.GetDefault("InitialView", "dayGridMonth")
		sInitialView = UI.CStr(sInitialView)
		sListText = Props.GetDefault("ListText", "list")
		sListText = UI.CStr(sListText)
		sLocale = Props.GetDefault("Locale", "en")
		sLocale = UI.CStr(sLocale)
		sMonthText = Props.GetDefault("MonthText", "month")
		sMonthText = UI.CStr(sMonthText)
		bNavLinks = Props.GetDefault("NavLinks", True)
		bNavLinks = UI.CBool(bNavLinks)
		bNextClickOn = Props.GetDefault("NextClickOn", False)
		bNextClickOn = UI.CBool(bNextClickOn)
		bNowIndicator = Props.GetDefault("NowIndicator", True)
		bNowIndicator = UI.CBool(bNowIndicator)
		bPrevClickOn = Props.GetDefault("PrevClickOn", False)
		bPrevClickOn = UI.CBool(bPrevClickOn)
		sScrollTime = Props.GetDefault("ScrollTime", "06:00:00")
		sScrollTime = UI.CStr(sScrollTime)
		bScrollTimeReset = Props.GetDefault("ScrollTimeReset", True)
		bScrollTimeReset = UI.CBool(bScrollTimeReset)
		bSelectMirror = Props.GetDefault("SelectMirror", True)
		bSelectMirror = UI.CBool(bSelectMirror)
		bSelectable = Props.GetDefault("Selectable", True)
		bSelectable = UI.CBool(bSelectable)
		sSlotDuration = Props.GetDefault("SlotDuration", "00:30:00")
		sSlotDuration = UI.CStr(sSlotDuration)
		sSlotMaxTime = Props.GetDefault("SlotMaxTime", "24:00:00")
		sSlotMaxTime = UI.CStr(sSlotMaxTime)
		sSlotMinTime = Props.GetDefault("SlotMinTime", "00:00:00")
		sSlotMinTime = UI.CStr(sSlotMinTime)
		sToDayText = Props.GetDefault("ToDayText", "today")
		sToDayText = UI.CStr(sToDayText)
		bWeekNumbers = Props.GetDefault("WeekNumbers", False)
		bWeekNumbers = UI.CBool(bWeekNumbers)
		sWeekText = Props.GetDefault("WeekText", "week")
		sWeekText = UI.CStr(sWeekText)
	End If
	'
	Dim xattrs As String = UI.BuildExAttributes
	Dim xstyles As String = UI.BuildExStyle
	Dim xclasses As String = UI.BuildExClass
	If sParentID <> "" Then
		'does the parent exist
		If BANano.Exists($"#${sParentID}"$) = False Then
			BANano.Throw($"${mName}.DesignerCreateView: '${sParentID}' parent does not exist!"$)
			Return
		End If
		mTarget.Initialize($"#${sParentID}"$)
	End If
	mElement = mTarget.Append($"[BANCLEAN]<div id="${mName}host" class="w-full relative z-0 flex flex-col min-w-0 p-3 break-words bg-white border-0 shadow-xl rounded-2xl bg-clip-border ${xclasses}" ${xattrs} style="${xstyles}">
		<div id="${mName}" class="w-full"></div>
	</div>"$).Get($"#${mName}"$)
	Refresh
End Sub

private Sub prevmonth(e As BANanoEvent)
	e.PreventDefault
	fc.RunMethod("prev", Null)
	BANano.CallSub(mCallBack, $"${mName}_prevmonth"$, Null)
End Sub
private Sub nextmonth(e As BANanoEvent)
	e.PreventDefault
	fc.RunMethod("next", Null)
	BANano.CallSub(mCallBack, $"${mName}_nextmonth"$, Null)
End Sub
private Sub prevyear(e As BANanoEvent)
	e.PreventDefault
	fc.RunMethod("prevYear", Null)
	BANano.CallSub(mCallBack, $"${mName}_prevyear"$, Null)
End Sub
private Sub nextyear(e As BANanoEvent)
	e.PreventDefault
	fc.RunMethod("nextYear", Null)
	BANano.CallSub(mCallBack, $"${mName}_nextyear"$, Null)
End Sub
private Sub DateRangeChange(dateInfo As Map)
	'if the view changed, persist it.
	sInitialView = UI.GetRecursive(dateInfo, "view.type")
	Options.Put("initialView", sInitialView)
	Dim range As Map = GetDateRange(dateInfo)
	Dim sstart As String = range.get("start")
	Dim send As String = range.Get("end")
	BANano.CallSub(mCallBack, $"${mName}_DateRangeChange"$, Array(sstart, send, sInitialView))
End Sub

Private Sub EventClick(e As Map)
	Dim eve As Map = e.Get("event")
	CallSub2(mCallBack, $"${mName}_eventclick"$, eve)
End Sub

Sub Refresh				'ignoredeadcode
	If sInitialDate = "now" Then sInitialDate = UI.DateNow
	sHeaderToolbarLeft = sHeaderToolbarLeft.Replace(";", ",")
	sHeaderToolbarRight = sHeaderToolbarRight.Replace(";", ",")
	
	UI.PutRecursive(Options, "headerToolbar.right", sHeaderToolbarRight)
	UI.PutRecursive(Options, "headerToolbar.left", sHeaderToolbarLeft)
	UI.PutRecursive(Options, "headerToolbar.center", sHeaderToolbarCenter)
	Options.Put("initialView", sInitialView)
	Options.put("scrollTime", sScrollTime)
	Options.put("scrollTimeReset", bScrollTimeReset)
	Options.put("slotDuration", sSlotDuration)
	Options.put("slotMaxTime", sSlotMaxTime)
	Options.put("slotMinTime", sSlotMinTime)
	Options.put("contentHeight", sContentHeight)
	Options.put("expandRows", bExpandRows)
	Options.put("height", sHeight)
	Options.Put("editable", bEditable)
	Options.Put("droppable", bDroppable)
	Options.Put("selectable", bSelectable)
	Options.put("nowIndicator", bNowIndicator)
	Options.Put("dayMaxEvents", bDayMaxEvents)
	Options.Put("navLinks", bNavLinks)
	Options.put("aspectRatio", sAspectRatio)
	Options.put("businessHours", bBusinessHours)
	Options.put("buttonIcons", bButtonIcons)	
	Options.put("initialDate", sInitialDate)
	Options.put("locale", sLocale)
	Options.put("nextClickOn", bNextClickOn)
	Options.put("prevClickOn", bPrevClickOn)
	Options.put("selectMirror", bSelectMirror)
	Options.put("weekNumbers", bWeekNumbers)
	
	Dim e As BANanoEvent
	If bPrevClickOn Then
		sHeaderToolbarLeft = sHeaderToolbarLeft.Replace("prev,", "cprev,")
		Dim cbBack As BANanoObject
		cbBack = BANano.CallBack(Me, "prevmonth", Array(e))
		UI.PutRecursive(Options, "customButtons.cprev.icon", "chevron-left")
		UI.PutRecursive(Options, "customButtons.cprev.click", cbBack)
		'
		sHeaderToolbarLeft = sHeaderToolbarLeft.Replace("prevYear,", "cprevYear,")
		Dim cbBackY As BANanoObject
		cbBackY = BANano.CallBack(Me, "prevyear", Array(e))
		UI.PutRecursive(Options, "customButtons.cprevYear.icon", "chevrons-left")
		UI.PutRecursive(Options, "customButtons.cprevYear.click", cbBackY)
	End If
	'
	If bNextClickOn Then
		sHeaderToolbarLeft = sHeaderToolbarLeft.Replace("next,", "cnext,")
		Dim cbNext As BANanoObject
		cbNext = BANano.CallBack(Me, "nextmonth", Array(e))
		UI.PutRecursive(Options, "customButtons.cnext.icon", "chevron-right")
		UI.PutRecursive(Options, "customButtons.cnext.click", cbNext)
		'
		sHeaderToolbarLeft = sHeaderToolbarLeft.Replace("nextYear", "cnextYear")
		Dim cbNextY As BANanoObject
		cbNextY = BANano.CallBack(Me, "nextyear", Array(e))
		UI.PutRecursive(Options, "customButtons.cnextYear.icon", "chevrons-right")
		UI.PutRecursive(Options, "customButtons.cnextYear.click", cbNextY)
	End If
	If SubExists(mCallBack, $"${mName}_DateRangeChange"$) Then
		Dim info As Map
		Dim cbRangeChange As BANanoObject = BANano.CallBack(Me, "DateRangeChange", Array(info))
		Options.Put("datesSet", cbRangeChange)
	End If
	'
	If SubExists(mCallBack, $"${mName}_eventdrop"$) Then
		Dim args As Object
		Dim cbED As BANanoObject = BANano.CallBack(mCallBack, $"${mName}_eventdrop"$, Array(args))
		Options.Put("eventDrop", cbED)
	End If
	If SubExists(mCallBack, $"${mName}_eventresize"$) Then
		Dim args As Object
		Dim cbER As BANanoObject = BANano.CallBack(mCallBack, $"${mName}_eventresize"$, Array(args))
		Options.Put("eventResize", cbER)
	End If
	If SubExists(mCallBack, $"${mName}_drop"$) Then
		Dim args As Object
		Dim cbD As BANanoObject = BANano.CallBack(mCallBack, $"${mName}_drop"$, Array(args))
		Options.Put("drop", cbD)
	End If
	If SubExists(mCallBack, $"${mName}_dateClick"$) Then
		Dim args As Object
		Dim cbDC As BANanoObject = BANano.CallBack(mCallBack, $"${mName}_dateClick"$, Array(args))
		Options.Put("dateClick", cbDC)
	End If
	If SubExists(mCallBack, $"${mName}_select"$) Then
		Dim args As Object
		Dim cbDC As BANanoObject = BANano.CallBack(mCallBack, $"${mName}_select"$, Array(args))
		Options.Put("select", cbDC)
	End If
	If bHeaderToolbarVisible = False Then
		UI.PutRecursive(Options, "headerToolbar", False)
	Else
		UI.PutRecursive(Options, "headerToolbar.left", sHeaderToolbarLeft)
		UI.PutRecursive(Options, "headerToolbar.center", sHeaderToolbarCenter)
		UI.PutRecursive(Options, "headerToolbar.right", sHeaderToolbarRight)
	End If
	If sLocale = "" Then
		If sToDayText <> "" Then UI.PutRecursive(Options, "buttonText.today", sToDayText)
		If sMonthText <> "" Then UI.PutRecursive(Options, "buttonText.month", sMonthText)
		If sWeekText <> "" Then UI.PutRecursive(Options, "buttonText.week", sWeekText)
		If sDayText <> "" Then UI.PutRecursive(Options, "buttonText.day", sDayText)
		If sListText <> "" Then UI.PutRecursive(Options, "buttonText.list", sListText)
	End If
	'
	If SubExists(mCallBack, $"${mName}_eventClick"$) Then
		Dim args As Object
		Dim cb2 As BANanoObject = BANano.CallBack(Me, "eventclick", Array(args))
		Options.Put("eventClick", cb2)
	End If
	Options.Put("events", events)
	UI.PutRecursive(Options, "eventTimeFormat.hour", "2-digit")
	UI.PutRecursive(Options, "eventTimeFormat.minute", "2-digit")
	UI.PutRecursive(Options, "eventTimeFormat.hour12", False)
	'
	Dim el As BANanoObject = mElement.ToObject
	fc.Initialize2("FullCalendar.Calendar", Array(el, Options))
	fc.RunMethod("render", Null)
End Sub

'set Aspect Ratio
Sub setAspectRatio(s As String)
	sAspectRatio = s
	CustProps.put("AspectRatio", s)
	Options.put("aspectRatio", sAspectRatio)
End Sub
'set Business Hours
Sub setBusinessHours(b As Boolean)
	bBusinessHours = b
	CustProps.put("BusinessHours", b)
	Options.put("businessHours", bBusinessHours)
End Sub
'set Show The Prev/next Text
Sub setButtonIcons(b As Boolean)
	bButtonIcons = b
	CustProps.put("ButtonIcons", b)
	Options.put("buttonIcons", bButtonIcons)
End Sub
'set Content Height
Sub setContentHeight(s As String)
	sContentHeight = s
	CustProps.put("ContentHeight", s)
	Options.put("contentHeight", sContentHeight)
End Sub
'set Day Max Events
Sub setDayMaxEvents(b As Boolean)
	bDayMaxEvents = b
	CustProps.put("DayMaxEvents", b)
	Options.put("dayMaxEvents", bDayMaxEvents)
End Sub
'set Day Text
Sub setDayText(s As String)
	sDayText = s
	CustProps.put("DayText", s)
	'Options.put("dayText", s)
End Sub

Sub UpdateLocale(s As String)
	s = UI.CStr(s)
	If s = "" Then Return
	sLocale = s
	fc.RunMethod("setOption", Array("locale", s))
End Sub

'set Droppable
Sub setDroppable(b As Boolean)
	bDroppable = b
	CustProps.put("Droppable", b)
	Options.put("droppable", bDroppable)
End Sub
'set Editable
Sub setEditable(b As Boolean)
	bEditable = b
	CustProps.put("Editable", b)
	Options.put("editable", bEditable)
End Sub
'set Expand Rows
Sub setExpandRows(b As Boolean)
	bExpandRows = b
	CustProps.put("ExpandRows", b)
	Options.put("expandRows", b)
End Sub
'set Header Toolbar Center
Sub setHeaderToolbarCenter(s As String)
	sHeaderToolbarCenter = s
	CustProps.put("HeaderToolbarCenter", s)
End Sub
'set Header Toolbar Left
Sub setHeaderToolbarLeft(s As String)
	sHeaderToolbarLeft = s
	CustProps.put("HeaderToolbarLeft", s)
End Sub
'set Header Toolbar Right
Sub setHeaderToolbarRight(s As String)
	sHeaderToolbarRight = s
	CustProps.put("HeaderToolbarRight", s)
End Sub
'set Header Toolbar Visible
Sub setHeaderToolbarVisible(b As Boolean)
	bHeaderToolbarVisible = b
	CustProps.put("HeaderToolbarVisible", b)
End Sub
'set Height
Sub setHeight(s As String)
	sHeight = s
	CustProps.put("Height", s)
	Options.put("height", sHeight)
End Sub
'set Initial Date
Sub setInitialDate(s As String)
	If s = "now" Then s = UI.DateNow
	sInitialDate = s
	CustProps.put("InitialDate", s)
	Options.put("initialDate", sInitialDate)
End Sub

'set Now
Sub setNow(s As String)
	s = UI.CStr(s)
	If s = "" Then Return
	If s = "now" Then s = UI.DateNow
	Options.put("now", s)
End Sub

'set Initial View
'options: dayGridMonth|dayGridWeek|listMonth|listWeek|timeGridDay|timeGridWeek|multiMonthYear
Sub setInitialView(s As String)
	sInitialView = s
	CustProps.put("InitialView", s)
	Options.put("initialView", sInitialView)
End Sub
'set List Text
Sub setListText(s As String)
	sListText = s
	CustProps.put("ListText", s)
	'Options.put("listText", s)
End Sub
'set Locale
Sub setLocale(s As String)
	sLocale = s
	CustProps.put("Locale", s)
	Options.put("locale", sLocale)
End Sub
'set Month Text
Sub setMonthText(s As String)
	sMonthText = s
	CustProps.put("MonthText", s)
	'Options.put("monthText", s)
End Sub
'set Nav Links
Sub setNavLinks(b As Boolean)
	bNavLinks = b
	CustProps.put("NavLinks", b)
	Options.put("navLinks", bNavLinks)
End Sub
'set Next Click On
Sub setNextClickOn(b As Boolean)
	bNextClickOn = b
	CustProps.put("NextClickOn", b)
	Options.put("nextClickOn", bNextClickOn)
End Sub
'set Now Indicator
Sub setNowIndicator(b As Boolean)
	bNowIndicator = b
	CustProps.put("NowIndicator", b)
	Options.put("nowIndicator", bNowIndicator)
End Sub
'set Prev Click On
Sub setPrevClickOn(b As Boolean)
	bPrevClickOn = b
	CustProps.put("PrevClickOn", b)
	Options.put("prevClickOn", bPrevClickOn)
End Sub
'set Determines How Far Forward The Scroll Pane Is Initially Scrolled
Sub setScrollTime(s As String)
	sScrollTime = s
	CustProps.put("ScrollTime", s)
	Options.put("scrollTime", sScrollTime)
End Sub
'set Whether The View Should Scroll To Scrolltime Every Time The Date Range Changes.
Sub setScrollTimeReset(b As Boolean)
	bScrollTimeReset = b
	CustProps.put("ScrollTimeReset", b)
	Options.put("scrollTimeReset", bScrollTimeReset)
End Sub
'set Select Mirror
Sub setSelectMirror(b As Boolean)
	bSelectMirror = b
	CustProps.put("SelectMirror", b)
	Options.put("selectMirror", bSelectMirror)
End Sub
'set Selectable
Sub setSelectable(b As Boolean)
	bSelectable = b
	CustProps.put("Selectable", b)
	Options.put("selectable", bSelectable)
End Sub
'set The Frequency For Displaying Time Slots.
Sub setSlotDuration(s As String)
	sSlotDuration = s
	CustProps.put("SlotDuration", s)
	Options.put("slotDuration", sSlotDuration)
End Sub
'set The Last Time Slot That Will Be Displayed For Each Day
Sub setSlotMaxTime(s As String)
	sSlotMaxTime = s
	CustProps.put("SlotMaxTime", s)
	Options.put("slotMaxTime", sSlotMaxTime)
End Sub
'set The First Time Slot That Will Be Displayed For Each Day
Sub setSlotMinTime(s As String)
	sSlotMinTime = s
	CustProps.put("SlotMinTime", s)
	Options.put("slotMinTime", sSlotMinTime)
End Sub
'set Today Text
Sub setToDayText(s As String)
	sToDayText = s
	CustProps.put("ToDayText", s)
	'Options.put("toDayText", s)
End Sub
'set Week Numbers
Sub setWeekNumbers(b As Boolean)
	bWeekNumbers = b
	CustProps.put("WeekNumbers", b)
	Options.put("weekNumbers", bWeekNumbers)
End Sub
'set Week Text
Sub setWeekText(s As String)
	sWeekText = s
	CustProps.put("WeekText", s)
	'Options.put("weekText", s)
End Sub

Sub gotoDate(s As String)
	s = UI.CStr(s)
	If s = "" Then Return
	fc.RunMethod("gotoDate", Array(s))
End Sub

Sub gotoToday
	fc.RunMethod("today", Null)
End Sub

Sub gotoPrevMonth
	fc.RunMethod("prev", Null)
End Sub

Sub gotoNextMonth
	fc.RunMethod("next", Null)
End Sub

'get Aspect Ratio
Sub getAspectRatio As String
	Return sAspectRatio
End Sub
'get Business Hours
Sub getBusinessHours As Boolean
	Return bBusinessHours
End Sub
'get Show The Prev/next Text
Sub getButtonIcons As Boolean
	Return bButtonIcons
End Sub
'get Content Height
Sub getContentHeight As String
	Return sContentHeight
End Sub
'get Day Max Events
Sub getDayMaxEvents As Boolean
	Return bDayMaxEvents
End Sub
'get Day Text
Sub getDayText As String
	Return sDayText
End Sub
'get Droppable
Sub getDroppable As Boolean
	Return bDroppable
End Sub
'get Editable
Sub getEditable As Boolean
	Return bEditable
End Sub
'get Expand Rows
Sub getExpandRows As Boolean
	Return bExpandRows
End Sub
'get Header Toolbar Center
Sub getHeaderToolbarCenter As String
	Return sHeaderToolbarCenter
End Sub
'get Header Toolbar Left
Sub getHeaderToolbarLeft As String
	Return sHeaderToolbarLeft
End Sub
'get Header Toolbar Right
Sub getHeaderToolbarRight As String
	Return sHeaderToolbarRight
End Sub
'get Header Toolbar Visible
Sub getHeaderToolbarVisible As Boolean
	Return bHeaderToolbarVisible
End Sub
'get Height
Sub getHeight As String
	Return sHeight
End Sub
'get Initial Date
Sub getInitialDate As String
	Return sInitialDate
End Sub
'get Initial View
Sub getInitialView As String
	Return sInitialView
End Sub
'get List Text
Sub getListText As String
	Return sListText
End Sub
'get Locale
Sub getLocale As String
	Return sLocale
End Sub
'get Month Text
Sub getMonthText As String
	Return sMonthText
End Sub
'get Nav Links
Sub getNavLinks As Boolean
	Return bNavLinks
End Sub
'get Next Click On
Sub getNextClickOn As Boolean
	Return bNextClickOn
End Sub
'get Now Indicator
Sub getNowIndicator As Boolean
	Return bNowIndicator
End Sub
'get Prev Click On
Sub getPrevClickOn As Boolean
	Return bPrevClickOn
End Sub
'get Determines How Far Forward The Scroll Pane Is Initially Scrolled
Sub getScrollTime As String
	Return sScrollTime
End Sub
'get Whether The View Should Scroll To Scrolltime Every Time The Date Range Changes.
Sub getScrollTimeReset As Boolean
	Return bScrollTimeReset
End Sub
'get Select Mirror
Sub getSelectMirror As Boolean
	Return bSelectMirror
End Sub
'get Selectable
Sub getSelectable As Boolean
	Return bSelectable
End Sub
'get The Frequency For Displaying Time Slots.
Sub getSlotDuration As String
	Return sSlotDuration
End Sub
'get The Last Time Slot That Will Be Displayed For Each Day
Sub getSlotMaxTime As String
	Return sSlotMaxTime
End Sub
'get The First Time Slot That Will Be Displayed For Each Day
Sub getSlotMinTime As String
	Return sSlotMinTime
End Sub
'get Today Text
Sub getToDayText As String
	Return sToDayText
End Sub
'get Week Numbers
Sub getWeekNumbers As Boolean
	Return bWeekNumbers
End Sub
'get Week Text
Sub getWeekText As String
	Return sWeekText
End Sub

Sub changeView(vName As String)
	fc.RunMethod("changeView", Array(vName))
	'update the view, so that when we refresh, we open last one
	setInitialView(vName)
End Sub

Sub ChangeViewDayGridMonth
	changeView("dayGridMonth")
End Sub

Sub ChangeViewDayGridWeek
	changeView("dayGridWeek")
End Sub

Sub ChangeViewListMonth
	changeView("listMonth")
End Sub

Sub ChangeViewListWeek
	changeView("listWeek")
End Sub

Sub ChangeViewTimeGridDay(day As String)
	fc.RunMethod("changeView", Array("timeGridDay", day))
	setInitialView("timeGridDay")
End Sub

Sub ChangeViewTimeGridWeek
	changeView("timeGridWeek")
End Sub
Sub gotoPrevYear
	fc.RunMethod("prevYear", Null)
End Sub
Sub gotoNextYear
	fc.RunMethod("nextYear", Null)
End Sub

Sub getCurrentDate As String
	Dim boDate As BANanoObject = fc.RunMethod("getDate", Null)
	Dim yyyy As String = boDate.RunMethod("getFullYear", Null).result
	Dim mm As Int = boDate.RunMethod("getMonth", Null).result
	mm = UI.CInt(mm) + 1
	Dim dd As String = boDate.RunMethod("getDate", Null).result
	mm = UI.PadRight(mm, 2, "0")
	dd = UI.PadRight(dd, 2, "0")
	Dim str As String = $"${yyyy}-${mm}-${dd}"$
	Return str
End Sub
Sub getCurrentStartDate As String
	Dim boDate As BANanoObject = fc.RunMethod("getDate", Null)
	Dim yyyy As String = boDate.RunMethod("getFullYear", Null).result
	Dim mm As Int = boDate.RunMethod("getMonth", Null).result
	mm = UI.CInt(mm) + 1
	mm = UI.PadRight(mm, 2, "0")
	Dim str As String = $"${yyyy}-${mm}-01"$
	Return str
End Sub
Sub getCurrentEndDate As String
	Dim boDate As BANanoObject = fc.RunMethod("getDate", Null)
	Dim yyyy As String = boDate.RunMethod("getFullYear", Null).result
	Dim mm As Int = boDate.RunMethod("getMonth", Null).result
	Dim dd As String = boDate.RunMethod("getDate", Null).result
	mm = UI.CInt(mm) + 1
	Dim obj1 As BANanoObject
	Dim int_d As Int = obj1.Initialize2("Date", Array(yyyy, mm, 1))
	obj1.Initialize2("Date", Array(int_d - 1))
	'
	Dim yyyy As String = obj1.RunMethod("getFullYear", Null).result
	Dim mm As Int = obj1.RunMethod("getMonth", Null).result
	Dim dd As String = obj1.RunMethod("getDate", Null).result
	mm = UI.CInt(mm) + 1
	mm = UI.PadRight(mm, 2, "0")
	dd = UI.PadRight(dd, 2, "0")
	Dim str As String = $"${yyyy}-${mm}-${dd}"$
	Return str
End Sub
private Sub GetDateRange(dateInfo As Map) As Map
	Dim dStart As Object = dateInfo.Get("startStr")
	Dim dEnd As Object = dateInfo.Get("endStr")
	'
	Dim d1 As BANanoObject
	d1.Initialize2("Date", dStart)
	Dim yyyy As String = d1.RunMethod("getFullYear", Null).result
	Dim mm As Int = d1.RunMethod("getMonth", Null).result
	Dim dd As String = d1.RunMethod("getDate", Null).result
	mm = UI.CInt(mm) + 1
	mm = UI.PadRight(mm, 2, "0")
	dd = UI.PadRight(dd, 2, "0")
	Dim sd1 As String = $"${yyyy}-${mm}-${dd}"$
	'
	Dim d2 As BANanoObject
	d2.Initialize2("Date", dEnd)
	Dim yyyy1 As String = d2.RunMethod("getFullYear", Null).result
	Dim mm1 As Int = d2.RunMethod("getMonth", Null).result
	Dim dd1 As String = d2.RunMethod("getDate", Null).result
	mm1 = UI.CInt(mm1) + 1
	mm1 = UI.PadRight(mm1, 2, "0")
	dd1 = UI.PadRight(dd1, 2, "0")
	Dim sd2 As String = $"${yyyy1}-${mm1}-${dd1}"$
	'
	Dim range As Map = CreateMap()
	range.Put("start", sd1)
	range.Put("end", sd2)
	Return range
End Sub

Sub Clear
	events.Initialize
End Sub

Sub AddEvent(eID As String, egroupId As String, eTitle As String, eStart As String, eEnd As String, eAllDay As Boolean, eurl As String, eColor As String, eConstraint As String, eBackground As Boolean, eOverlap As Boolean)
	Dim eve As Map = CreateMap()
	If eID <> "" Then eve.Put("id", eID)
	If eTitle <> "" Then eve.Put("title", eTitle)
	If eStart <> "" Then eve.Put("start", eStart)
	If eEnd <> "" Then eve.Put("end", eEnd)
	If egroupId <> "" Then eve.Put("groupId", egroupId)
	If eurl <> "" Then eve.Put("url", eurl)
	If eAllDay Then eve.Put("allDay", eAllDay)
	If eConstraint <> "" Then eve.put("constraint", eConstraint)
	If eColor <> "" Then eve.put("color", eColor)
	If eBackground Then
		eve.put("display", "background")
	End If
	If eOverlap Then eve.Put("overlap", eOverlap)
	events.Add(eve)
End Sub

Sub UnSelect
	fc.RunMethod("unselect", Null)
End Sub